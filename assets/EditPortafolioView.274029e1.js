import{Q as U}from"./QPage.1ea919ed.js";import{_ as E,r as b,o as w,e as s,f,F as r,l,aD as k,as as x,j as g,H as p,aB as m,k as n,Q as _,aC as S,at as D,aX as F,L as A,G as y,bm as z,I as V}from"./index.a41ae495.js";import{Q}from"./QSelect.1de7a70a.js";import{Q as N}from"./QForm.4030cafd.js";import{u as I}from"./use-quasar.1e6fead0.js";import{c as j,a as q}from"./object.d8999c0c.js";import{u as B,a as L}from"./usePortafolios.5c5f720b.js";import{Q as T}from"./QInnerLoading.051e4275.js";import{Q as h,a as R,b as M}from"./QUploader.22a9a66b.js";import{A as G}from"./constants.9e8d69f8.js";import"./QItem.c2052c42.js";import"./QItemLabel.f8c15c9b.js";import"./QMenu.43d920a2.js";import"./selection.b7a6f271.js";const H={props:["id","portafolio","editPortafolio"],setup(i){const a=b({}),d=b({}),o=b(!1),c=I(),u=j().shape({titulo:q().required("El titulo no puede estar vacio."),categoria:q().required("Debe seleccionar una categoria."),descripcion:q().min(10,"Al menos debe tener 10 caracteres").required("Debe ingresar una descripci\xF3n.")}),{categorias:e}=B();return w(async()=>{const{portafolio:t}=await i.portafolio(i.id);t.recomedar==!0?t.recomedar={label:"Si",value:t.recomedar}:t.recomedar={label:"No",value:t.recomedar},a.value={titulo:t.titulo,descripcion:t.descripcion,enlace:t.enlace,recomedar:t.recomedar,categoria:{label:t.categoria.nombre,value:t.categoria._id}}}),{loading:o,categorias:e,options:[{label:"Si",value:!0},{label:"No",value:!1}],formData:a,formError:d,onSubmit:async()=>{d.value={};const t={titulo:a.value.titulo,descripcion:a.value.descripcion,enlace:a.value.enlace,recomedar:a.value.recomedar.value,categoria:a.value.categoria.value};t.enlace||delete t.enlace,t.recomedar===""&&delete t.recomedar;try{await u.validate(t,{abortEarly:!1});try{o.value=!0;const{msg:v}=await i.editPortafolio(i.id,t);v=="ok"&&c.notify({message:"\xA1Portafolio actualizado con \xE9xito!",color:"green-10",position:"top-right",icon:"lar la-check-circle"}),o.value=!1}catch(v){console.log(v)}}catch(v){v.inner.forEach(C=>{d.value[C.path]=C.message})}}}}},X={key:0,class:"q-mx-lg text-red-6 text-weight-bold"},J={key:1,class:"q-mx-lg text-red-6 text-weight-bold"},K={key:2,class:"q-mx-lg text-red-6 text-weight-bold"},O={class:"row justify-end"};function W(i,a,d,o,c,u){return s(),f(D,{class:"q-pa-md"},{default:r(()=>[l(N,{class:"q-gutter-md",onSubmit:S(o.onSubmit,["prevent"])},{default:r(()=>[l(k,{filled:"",label:"Titulo",modelValue:o.formData.titulo,"onUpdate:modelValue":a[0]||(a[0]=e=>o.formData.titulo=e),color:"indigo-6",class:x({error:o.formError.titulo})},null,8,["modelValue","class"]),o.formError.titulo?(s(),g("span",X,p(o.formError.titulo),1)):m("",!0),l(Q,{filled:"",label:"Categoria",options:o.categorias,modelValue:o.formData.categoria,"onUpdate:modelValue":a[1]||(a[1]=e=>o.formData.categoria=e),color:"indigo-6",class:x({error:o.formError.categoria})},null,8,["options","modelValue","class"]),o.formError.categorias?(s(),g("span",J,p(o.formError.categorias),1)):m("",!0),l(k,{filled:"",label:"Enlace",modelValue:o.formData.enlace,"onUpdate:modelValue":a[2]||(a[2]=e=>o.formData.enlace=e),color:"indigo-6"},null,8,["modelValue"]),l(Q,{filled:"",label:"Recomendar",options:o.options,modelValue:o.formData.recomedar,"onUpdate:modelValue":a[3]||(a[3]=e=>o.formData.recomedar=e),color:"indigo-6"},null,8,["options","modelValue"]),l(k,{filled:"",label:"Descripci\xF3n",type:"textarea",modelValue:o.formData.descripcion,"onUpdate:modelValue":a[4]||(a[4]=e=>o.formData.descripcion=e),color:"indigo-6",class:x({error:o.formError.descripcion})},null,8,["modelValue","class"]),o.formError.descripcion?(s(),g("span",K,p(o.formError.descripcion),1)):m("",!0),n("div",O,[l(_,{type:"submit",color:"indigo-6",label:"Actualizar",class:"self-center q-ma-sm q-py-sm","icon-right":"las la-cube",loading:o.loading},null,8,["loading"])])]),_:1},8,["onSubmit"])]),_:1})}var Y=E(H,[["render",W],["__scopeId","data-v-378c7b01"]]);const Z={props:["id","portafolio"],setup(i){const a=b(),d=I();return w(async()=>{const{portafolio:c}=await i.portafolio(i.id);a.value=c.img}),{uploadImg:c=>new Promise(u=>{setTimeout(()=>{u({url:`${G}/api/uploads/portafolios/${i.id}`,method:"PUT",fieldName:"archivo"}),d.notify({message:"\xA1Imagen actualizada con \xE9xito!",color:"green-10",position:"top-right",icon:"lar la-check-circle"})},2e3)}),img:a}}},$={class:"justify-center row"},oo=["loading"],eo=["src"],ao={class:"row justify-center"},to={class:"row no-wrap items-center q-pa-sm q-gutter-xs"},lo=y("Limpiar"),ro=y("Remover archivo"),io={class:"col"},so=n("div",{class:"q-uploader__title"},"Actualizar Imagen",-1),no={class:"q-uploader__subtitle"},co=y("Elegir Archivo"),mo=y("Subir archivo"),uo=y("Abortar");function fo(i,a,d,o,c,u){return s(),g(A,null,[l(D,{class:"q-mb-md"},{default:r(()=>[n("div",$,[o.img?(s(),g("img",{key:1,src:o.img,class:"q-pa-sm",style:{width:"300px",height:"200px"}},null,8,eo)):(s(),g("img",{key:0,src:"https://cdn.quasar.dev/img/boy-avatar.png",class:"q-pa-sm",style:{width:"200px"},loading:i.loading},null,8,oo))]),n("div",ao,[l(T,{showing:i.loading,label:"Espere un momento...","label-class":"text-indigo-6","label-style":"font-size: 1.1em"},null,8,["showing"])])]),_:1}),l(M,{style:{width:"100%"},label:"Cambiar foto",accept:".jpg, image/*",factory:o.uploadImg,color:"indigo-6"},{header:r(e=>[n("div",to,[e.queuedFiles.length>0?(s(),f(_,{key:0,icon:"clear_all",onClick:e.removeQueuedFiles,round:"",dense:"",flat:""},{default:r(()=>[l(h,null,{default:r(()=>[lo]),_:1})]),_:2},1032,["onClick"])):m("",!0),e.uploadedFiles.length>0?(s(),f(_,{key:1,icon:"done_all",onClick:e.removeUploadedFiles,round:"",dense:"",flat:""},{default:r(()=>[l(h,null,{default:r(()=>[ro]),_:1})]),_:2},1032,["onClick"])):m("",!0),e.isUploading?(s(),f(F,{key:2,class:"q-uploader__spinner"})):m("",!0),n("div",io,[so,n("div",no,p(e.uploadSizeLabel)+" / "+p(e.uploadProgressLabel),1)]),e.canAddFiles?(s(),f(_,{key:3,type:"a",icon:"add_box",onClick:e.pickFiles,round:"",dense:"",flat:""},{default:r(()=>[l(R),l(h,null,{default:r(()=>[co]),_:1})]),_:2},1032,["onClick"])):m("",!0),e.canUpload?(s(),f(_,{key:4,icon:"las la-upload",onClick:e.upload,round:"",dense:"",color:"dark"},{default:r(()=>[l(h,null,{default:r(()=>[mo]),_:1})]),_:2},1032,["onClick"])):m("",!0),e.isUploading?(s(),f(_,{key:5,icon:"clear",onClick:e.abort,round:"",dense:"",flat:""},{default:r(()=>[l(h,null,{default:r(()=>[uo]),_:1})]),_:2},1032,["onClick"])):m("",!0)])]),_:1},8,["factory"])],64)}var _o=E(Z,[["render",fo]]);const go={components:{EditPortafolio:Y,EditImgPortafolio:_o},setup(){const a=z().params.id,d=b(),{getPortafolio:o,editPortafolio:c}=L();return w(async()=>{const{portafolio:u}=await o(a);d.value=u.titulo}),{id:a,getPortafolio:o,editPortafolio:c,titulo:d}}},po={class:"row justify-center"},vo={class:"col-12"},ho={class:"text-h4 text-dark"},bo={class:"col-12 col-md-4 q-ma-md"},yo={class:"col-12 col-md-6 q-ma-md"};function ko(i,a,d,o,c,u){const e=V("EditImgPortafolio"),P=V("EditPortafolio");return s(),f(U,{class:"q-pa-md bg-white"},{default:r(()=>[n("div",po,[n("div",vo,[n("span",ho,p(o.titulo),1)]),n("div",bo,[l(e,{id:o.id,portafolio:o.getPortafolio},null,8,["id","portafolio"])]),n("div",yo,[l(P,{id:o.id,portafolio:o.getPortafolio,editPortafolio:o.editPortafolio},null,8,["id","portafolio","editPortafolio"])])])]),_:1})}var zo=E(go,[["render",ko]]);export{zo as default};
