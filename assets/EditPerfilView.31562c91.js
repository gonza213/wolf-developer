import{Q as ye}from"./QInnerLoading.f8ef1d37.js";import{p as ue,z as _e,aY as be,A as we,r as k,m as C,ax as Se,a3 as ke,aZ as Fe,B as qe,b5 as Te,w as J,P as $,$ as ee,V as te,ab as xe,h as ae,am as Ue,y as Ce,D as Ee,a0 as Pe,q as Qe,bm as Ae,bn as ze,_ as de,o as ce,e as b,f as T,F as v,l as g,aD as oe,k as y,Q as O,aC as Oe,bo as De,I as Re,H as K,j as ne,at as Ve,aB as z,aX as Le,G as j}from"./index.29806dde.js";import{u as Ne,v as le,a as Be,p as ie,b as je,c as He,r as re,s as Ie,d as Me}from"./QMenu.8a8d383d.js";import{c as se}from"./selection.2499a8e5.js";import{Q as We}from"./QPage.00dc6b8f.js";import{u as me}from"./use-quasar.150d19b7.js";import{u as Xe}from"./useUsuarios.344c6ef0.js";import{Q as Ge}from"./QSelect.62f6c531.js";import{Q as Ke}from"./QForm.b87600b7.js";import{A as Ye}from"./constants.9e8d69f8.js";import"./QItem.c9fc7e41.js";import"./QItemLabel.4153c487.js";var B=ue({name:"QTooltip",inheritAttrs:!1,props:{...Ne,..._e,...be,maxHeight:{type:String,default:null},maxWidth:{type:String,default:null},transitionShow:{default:"jump-down"},transitionHide:{default:"jump-up"},anchor:{type:String,default:"bottom middle",validator:le},self:{type:String,default:"top middle",validator:le},offset:{type:Array,default:()=>[14,14],validator:Be},scrollTarget:{default:void 0},delay:{type:Number,default:0},hideDelay:{type:Number,default:0}},emits:[...we],setup(e,{slots:i,emit:o,attrs:a}){let u,r;const c=Ce(),{proxy:{$q:l}}=c,F=k(null),h=k(!1),D=C(()=>ie(e.anchor,l.lang.rtl)),X=C(()=>ie(e.self,l.lang.rtl)),H=C(()=>e.persistent!==!0),{registerTick:R,removeTick:t}=Se(),{registerTimeout:d,removeTimeout:_}=ke(),{transition:s,transitionStyle:f}=Fe(e,h),{localScrollTarget:V,changeScrollEvent:I,unconfigureScrollTarget:M}=je(e,Y),{anchorEl:p,canShow:E,anchorEvents:q}=He({showing:h,configureAnchorEl:ge}),{show:W,hide:P}=qe({showing:h,canShow:E,handleShow:Q,handleHide:N,hideOnRouteChange:H,processOnMount:!0});Object.assign(q,{delayShow:fe,delayHide:ve});const{showPortal:L,hidePortal:n,renderPortal:x}=Te(c,F,pe);if(l.platform.is.mobile===!0){const m={anchorEl:p,innerRef:F,onClickOutside(U){return P(U),U.target.classList.contains("q-dialog__backdrop")&&Pe(U),!0}},G=C(()=>e.modelValue===null&&e.persistent!==!0&&h.value===!0);J(G,U=>{(U===!0?Me:re)(m)}),$(()=>{re(m)})}function Q(m){t(),_(),L(),R(()=>{r=new MutationObserver(()=>A()),r.observe(F.value,{attributes:!1,childList:!0,characterData:!0,subtree:!0}),A(),Y()}),u===void 0&&(u=J(()=>l.screen.width+"|"+l.screen.height+"|"+e.self+"|"+e.anchor+"|"+l.lang.rtl,A)),d(()=>{L(!0),o("show",m)},e.transitionDuration)}function N(m){t(),_(),n(),w(),d(()=>{n(!0),o("hide",m)},e.transitionDuration)}function w(){r!==void 0&&(r.disconnect(),r=void 0),u!==void 0&&(u(),u=void 0),M(),ee(q,"tooltipTemp")}function A(){const m=F.value;p.value===null||!m||Ie({el:m,offset:e.offset,anchorEl:p.value,anchorOrigin:D.value,selfOrigin:X.value,maxHeight:e.maxHeight,maxWidth:e.maxWidth})}function fe(m){if(l.platform.is.mobile===!0){se(),document.body.classList.add("non-selectable");const G=p.value,U=["touchmove","touchcancel","touchend","click"].map(Z=>[G,Z,"delayHide","passiveCapture"]);te(q,"tooltipTemp",U)}d(()=>{W(m)},e.delay)}function ve(m){_(),l.platform.is.mobile===!0&&(ee(q,"tooltipTemp"),se(),setTimeout(()=>{document.body.classList.remove("non-selectable")},10)),d(()=>{P(m)},e.hideDelay)}function ge(){if(e.noParentEvent===!0||p.value===null)return;const m=l.platform.is.mobile===!0?[[p.value,"touchstart","delayShow","passive"]]:[[p.value,"mouseenter","delayShow","passive"],[p.value,"mouseleave","delayHide","passive"]];te(q,"anchor",m)}function Y(){if(p.value!==null||e.scrollTarget!==void 0){V.value=xe(p.value,e.scrollTarget);const m=e.noParentEvent===!0?A:P;I(V.value,m)}}function he(){return h.value===!0?ae("div",{...a,ref:F,class:["q-tooltip q-tooltip--style q-position-engine no-pointer-events",a.class],style:[a.style,f.value],role:"complementary"},Ee(i.default)):null}function pe(){return ae(Ue,{name:s.value,appear:!0},he)}return $(w),Object.assign(c.proxy,{updatePosition:A}),x}}),Ze=ue({name:"QUploaderAddTrigger",setup(){return Qe(Ae,()=>{console.error("QUploaderAddTrigger needs to be child of QUploader")})}});function S(e){return typeof e=="function"?e:()=>e}const Je={url:[Function,String],method:{type:[Function,String],default:"POST"},fieldName:{type:[Function,String],default:()=>e=>e.name},headers:[Function,Array],formFields:[Function,Array],withCredentials:[Function,Boolean],sendRaw:[Function,Boolean],batch:[Function,Boolean],factory:Function},$e=["factory-failed","uploaded","failed","uploading"];function et({props:e,emit:i,helpers:o}){const a=k([]),u=k([]),r=k(0),c=C(()=>({url:S(e.url),method:S(e.method),headers:S(e.headers),formFields:S(e.formFields),fieldName:S(e.fieldName),withCredentials:S(e.withCredentials),sendRaw:S(e.sendRaw),batch:S(e.batch)})),l=C(()=>r.value>0),F=C(()=>u.value.length>0);let h;function D(){a.value.forEach(t=>{t.abort()}),u.value.length>0&&(h=!0)}function X(){const t=o.queuedFiles.value.slice(0);o.queuedFiles.value=[],c.value.batch(t)?H(t):t.forEach(d=>{H([d])})}function H(t){if(r.value++,typeof e.factory!="function"){R(t,{});return}const d=e.factory(t);if(!d)i("factory-failed",new Error("QUploader: factory() does not return properly"),t),r.value--;else if(typeof d.catch=="function"&&typeof d.then=="function"){u.value.push(d);const _=s=>{o.isAlive()===!0&&(u.value=u.value.filter(f=>f!==d),u.value.length===0&&(h=!1),o.queuedFiles.value=o.queuedFiles.value.concat(t),t.forEach(f=>{o.updateFileStatus(f,"failed")}),i("factory-failed",s,t),r.value--)};d.then(s=>{h===!0?_(new Error("Aborted")):o.isAlive()===!0&&(u.value=u.value.filter(f=>f!==d),R(t,s))}).catch(_)}else R(t,d||{})}function R(t,d){const _=new FormData,s=new XMLHttpRequest,f=(n,x)=>d[n]!==void 0?S(d[n])(x):c.value[n](x),V=f("url",t);if(!V){console.error("q-uploader: invalid or no URL specified"),r.value--;return}const I=f("formFields",t);I!==void 0&&I.forEach(n=>{_.append(n.name,n.value)});let M=0,p=0,E=0,q=0,W;s.upload.addEventListener("progress",n=>{if(W===!0)return;const x=Math.min(q,n.loaded);o.uploadedSize.value+=x-E,E=x;let Q=E-p;for(let N=M;Q>0&&N<t.length;N++){const w=t[N];if(Q>w.size)Q-=w.size,M++,p+=w.size,o.updateFileStatus(w,"uploading",w.size);else{o.updateFileStatus(w,"uploading",Q);return}}},!1),s.onreadystatechange=()=>{s.readyState<4||(s.status&&s.status<400?(o.uploadedFiles.value=o.uploadedFiles.value.concat(t),t.forEach(n=>{o.updateFileStatus(n,"uploaded")}),i("uploaded",{files:t,xhr:s})):(W=!0,o.uploadedSize.value-=E,o.queuedFiles.value=o.queuedFiles.value.concat(t),t.forEach(n=>{o.updateFileStatus(n,"failed")}),i("failed",{files:t,xhr:s})),r.value--,a.value=a.value.filter(n=>n!==s))},s.open(f("method",t),V),f("withCredentials",t)===!0&&(s.withCredentials=!0);const P=f("headers",t);P!==void 0&&P.forEach(n=>{s.setRequestHeader(n.name,n.value)});const L=f("sendRaw",t);t.forEach(n=>{o.updateFileStatus(n,"uploading",0),L!==!0&&_.append(f("fieldName",n),n,n.name),n.xhr=s,n.__abort=()=>{s.abort()},q+=n.size}),i("uploading",{files:t,xhr:s}),a.value.push(s),L===!0?s.send(new Blob(t)):s.send(_)}return{isUploading:l,isBusy:F,abort:D,upload:X}}var tt={name:"QUploader",props:Je,emits:$e,injectPlugin:et},at=ze(tt);const ot={props:["usuario","uid","editar"],setup(e){const i=k({nombre:"",rol:"",password:""}),o=me(),a=k(!1);return ce(async()=>{const{usuario:r}=await e.usuario(e.uid);i.value={nombre:r.nombre,rol:r.rol}}),{onSubmit:async()=>{i.value.password||delete i.value.password;try{a.value=!0;const{msg:r}=await e.editar(e.uid,i.value);r=="ok"&&o.notify({message:"\xA1Usuario actualizado con \xE9xito!",color:"green-10",position:"top-right",icon:"lar la-check-circle"}),a.value=!1}catch(r){o.notify({message:`${r}`,color:"red-10",position:"top-right",icon:"lar la-exclamation-circle"})}},formData:i,loading:a,options:["ADMIN_ROLE","USER_ROLE"]}}},nt={class:"row justify-end"};function lt(e,i,o,a,u,r){return b(),T(Ke,{class:"q-gutter-md q-mt-md",onSubmit:Oe(a.onSubmit,["prevent"])},{default:v(()=>[g(oe,{filled:"",modelValue:a.formData.nombre,"onUpdate:modelValue":i[0]||(i[0]=c=>a.formData.nombre=c),label:"Nombre completo",color:"indigo-6"},null,8,["modelValue"]),g(oe,{filled:"",modelValue:a.formData.password,"onUpdate:modelValue":i[1]||(i[1]=c=>a.formData.password=c),type:"password",label:"Nueva contrase\xF1a",color:"indigo-6"},null,8,["modelValue"]),g(Ge,{filled:"",modelValue:a.formData.rol,"onUpdate:modelValue":i[2]||(i[2]=c=>a.formData.rol=c),options:a.options,label:"Rol",color:"indigo-6"},null,8,["modelValue","options"]),y("div",nt,[g(O,{type:"submit",color:"indigo-6",label:"Actualizar",class:"self-center q-ma-sm q-py-sm","icon-right":"las la-user",loading:a.loading},null,8,["loading"])])]),_:1},8,["onSubmit"])}var it=de(ot,[["render",lt]]);const rt={components:{EditarUser:it},setup(){const i=De().params.id,{getUsuario:o,editUsuario:a,loading:u}=Xe(),r=k(),c=k(),l=me();return ce(async()=>{const h=await o(i);r.value=h.usuario.img,c.value=h.usuario.nombre}),{img:r,getUsuario:o,editUsuario:a,id:i,nombre:c,uploadImg:h=>new Promise(D=>{setTimeout(()=>{D({url:`${Ye}/api/uploads/usuarios/${i}`,method:"PUT",fieldName:"archivo"}),l.notify({message:"\xA1Foto actualizada con \xE9xito!",color:"green-10",position:"top-right",icon:"lar la-check-circle"})},2e3)}),loading:u}}},st={class:"text-h4 text-indigo-6"},ut={class:"row justify-center"},dt={class:"col-md-4 col-12 q-pa-md"},ct={class:"justify-center row"},mt=["loading"],ft=["src"],vt={class:"row justify-center"},gt={class:"row no-wrap items-center q-pa-sm q-gutter-xs"},ht=j("Limpiar"),pt=j("Remover archivo"),yt={class:"col"},_t=y("div",{class:"q-uploader__title"},"Actualizar foto de perfil",-1),bt={class:"q-uploader__subtitle"},wt=j("Elegir Archivo"),St=j("Subir archivo"),kt=j("Abortar"),Ft={class:"col-md-5 col-12 q-pa-md-md q-pa-xs-sm q-mt-md bg-dark"};function qt(e,i,o,a,u,r){const c=Re("EditarUser");return b(),T(We,{class:"q-pa-md bg-white"},{default:v(()=>[y("span",st,"Editar usuario "+K(a.nombre),1),y("div",ut,[y("div",dt,[g(Ve,{class:"q-mb-md"},{default:v(()=>[y("div",ct,[a.img?(b(),ne("img",{key:1,src:a.img,class:"q-pa-sm",style:{width:"200px"}},null,8,ft)):(b(),ne("img",{key:0,src:"https://cdn.quasar.dev/img/boy-avatar.png",class:"q-pa-sm",style:{width:"200px"},loading:a.loading},null,8,mt))]),y("div",vt,[g(ye,{showing:a.loading,label:"Espere un momento...","label-class":"text-indigo-6","label-style":"font-size: 1.1em"},null,8,["showing"])])]),_:1}),g(at,{style:{width:"100%"},label:"Cambiar foto",accept:".jpg, image/*",factory:a.uploadImg,color:"indigo-6"},{header:v(l=>[y("div",gt,[l.queuedFiles.length>0?(b(),T(O,{key:0,icon:"clear_all",onClick:l.removeQueuedFiles,round:"",dense:"",flat:""},{default:v(()=>[g(B,null,{default:v(()=>[ht]),_:1})]),_:2},1032,["onClick"])):z("",!0),l.uploadedFiles.length>0?(b(),T(O,{key:1,icon:"done_all",onClick:l.removeUploadedFiles,round:"",dense:"",flat:""},{default:v(()=>[g(B,null,{default:v(()=>[pt]),_:1})]),_:2},1032,["onClick"])):z("",!0),l.isUploading?(b(),T(Le,{key:2,class:"q-uploader__spinner"})):z("",!0),y("div",yt,[_t,y("div",bt,K(l.uploadSizeLabel)+" / "+K(l.uploadProgressLabel),1)]),l.canAddFiles?(b(),T(O,{key:3,type:"a",icon:"add_box",onClick:l.pickFiles,round:"",dense:"",flat:""},{default:v(()=>[g(Ze),g(B,null,{default:v(()=>[wt]),_:1})]),_:2},1032,["onClick"])):z("",!0),l.canUpload?(b(),T(O,{key:4,icon:"las la-upload",onClick:l.upload,round:"",dense:"",color:"dark"},{default:v(()=>[g(B,null,{default:v(()=>[St]),_:1})]),_:2},1032,["onClick"])):z("",!0),l.isUploading?(b(),T(O,{key:5,icon:"clear",onClick:l.abort,round:"",dense:"",flat:""},{default:v(()=>[g(B,null,{default:v(()=>[kt]),_:1})]),_:2},1032,["onClick"])):z("",!0)])]),_:1},8,["factory"])]),y("div",Ft,[g(c,{usuario:a.getUsuario,uid:a.id,editar:a.editUsuario},null,8,["usuario","uid","editar"])])])]),_:1})}var Vt=de(rt,[["render",qt]]);export{Vt as default};
